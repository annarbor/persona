<!DOCTYPE HTML>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Persona</title>
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
<script type="text/javascript" src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
<script type="text/javascript" src="https://login.persona.org/include.js"></script>
<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.1.5.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    Parse.initialize("uQSC54eGu2hDDVXbfjkwbcPbVxlJaN2x1vUgZh6K", "9zJh2WvfFjZWBW0DKJd84KXmDmSDFm5IKKFsZGsA");

    var signinLink = document.getElementById('signin');
    if (signinLink) {
      signinLink.onclick = function() { navigator.id.request(); };
    };
 
    var signoutLink = document.getElementById('signout');
    if (signoutLink) {
      signoutLink.onclick = function() { navigator.id.logout(); };
    };

    var currentUser = 'bob@example.com';
 
    navigator.id.watch({
//      loggedInUser: currentUser,
      onlogin: function(assertion) {
        // ユーザがログインしました！ ここで必要なことは:
        // 1. 検証してセッションを作成するため、アサーションをバックエンドに送信する。
        Parse.Cloud.run('hello', {}, {
          success: function(result) {
          },
          error: function(error) {
          }
        });
        // 2. UI を更新する。
//        $.ajax({ /* <-- この例では jQuery を使いますが、他のものも使えます */
//         type: 'POST',
//          url: '/auth/login', // これは、あなたの Web サイト上の URL です。
//          data: {assertion: assertion},
//          success: function(res, status, xhr) { window.location.reload(); },
//          error: function(res, status, xhr) { alert("login failure" + res); }
//        });
      },
      onlogout: function() {
        // ユーザがログアウトしました！ ここで必要なことは:
        // リダイレクトするかバックエンドの呼び出しを行って、ユーザのセッションを破棄する。
//        $.ajax({
//          type: 'POST',
//          url: '/auth/logout', // これは、あなたの Web サイト上の URL です。
//          success: function(res, status, xhr) { window.location.reload(); },
//          error: function(res, status, xhr) { alert("logout failure" + res); }
//        });
      }
    });

  });
</script>
<style>
</style>
</head>

<body>
<!-- ページ -->
<div data-role="page" id="top" data-add-back-btn="true">
<!-- ヘッダー -->
<div data-role="header">
<h1>ログイン</h1>
</div>
<!-- コンテンツ -->
<div data-role="content">
<ul data-role="listview">
<li><a href="#signin" id="signin">Sign In with Persona</a></li>
<li><a href="#signout" id="singout">Sign Out</a></li>
</ul>
</div>
<!-- フッター -->
<div data-role="footer">
<h4>フッター</h4-->
</div>
</div>
</body>

</html>
